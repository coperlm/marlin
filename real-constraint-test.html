<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çœŸå®çº¦æŸéªŒè¯ - Marlin zkSNARK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen text-white">
    <div class="container mx-auto px-6 py-8" x-data="constraintTester()">
        
        <!-- æ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
                ğŸ”’ çœŸå®çº¦æŸéªŒè¯ç³»ç»Ÿ
            </h1>
            <p class="text-lg text-gray-300">
                åŸºäºçœŸå®çš„Rust Marlin zkSNARKå®ç° - æ¯æ¬¡æµ‹è¯•éƒ½è¿è¡Œå®Œæ•´çš„å¯†ç å­¦è¯æ˜ï¼
            </p>
            <div class="mt-2 inline-flex items-center px-4 py-2 bg-green-800/30 text-green-300 rounded-full text-sm">
                <span class="w-3 h-3 bg-green-400 rounded-full mr-2 animate-pulse"></span>
                çœŸå®Rustç¨‹åºè¿è¡Œä¸­
            </div>
        </div>

        <!-- çº¦æŸè¾“å…¥åŒºåŸŸ -->
        <div class="max-w-2xl mx-auto mb-8">
            <div class="bg-white/10 backdrop-blur rounded-xl p-6 border border-white/20">
                <h2 class="text-2xl font-semibold mb-4 text-center">ğŸ§® çº¦æŸæµ‹è¯•</h2>
                <p class="text-gray-300 text-center mb-6">
                    è¾“å…¥ä¸‰ä¸ªæ•°å­—æ¥æµ‹è¯•ä¹˜æ³•çº¦æŸï¼ša Ã— b = c
                </p>
                
                <div class="grid grid-cols-5 gap-4 items-center mb-6">
                    <div class="text-center">
                        <label class="block text-sm font-medium mb-2">a</label>
                        <input type="number" 
                               x-model="inputs.a" 
                               class="w-full px-3 py-2 bg-white/10 border border-white/30 rounded-lg text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"
                               :disabled="isLoading">
                    </div>
                    <div class="text-center text-2xl font-bold">Ã—</div>
                    <div class="text-center">
                        <label class="block text-sm font-medium mb-2">b</label>
                        <input type="number" 
                               x-model="inputs.b" 
                               class="w-full px-3 py-2 bg-white/10 border border-white/30 rounded-lg text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"
                               :disabled="isLoading">
                    </div>
                    <div class="text-center text-2xl font-bold">=</div>
                    <div class="text-center">
                        <label class="block text-sm font-medium mb-2">c</label>
                        <input type="number" 
                               x-model="inputs.c" 
                               class="w-full px-3 py-2 bg-white/10 border border-white/30 rounded-lg text-white text-center focus:outline-none focus:ring-2 focus:ring-blue-500"
                               :disabled="isLoading">
                    </div>
                </div>

                <!-- é¢„è®¾çº¦æŸæŒ‰é’® -->
                <div class="flex flex-wrap gap-2 justify-center mb-6">
                    <button @click="setConstraint(3, 5, 15)" 
                            class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm transition-colors">
                        âœ… æ­£ç¡®: 3Ã—5=15
                    </button>
                    <button @click="setConstraint(3, 5, 16)" 
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
                        âŒ é”™è¯¯: 3Ã—5=16
                    </button>
                    <button @click="setConstraint(7, 8, 56)" 
                            class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-sm transition-colors">
                        âœ… æ­£ç¡®: 7Ã—8=56
                    </button>
                    <button @click="setConstraint(7, 8, 42)" 
                            class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-sm transition-colors">
                        âŒ é”™è¯¯: 7Ã—8=42
                    </button>
                </div>

                <!-- æµ‹è¯•æŒ‰é’® -->
                <div class="flex gap-4 justify-center">
                    <button @click="runConstraintTest()" 
                            :disabled="isLoading"
                            class="px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors flex items-center gap-2">
                        <span x-show="!isLoading">ğŸ”’ è¿è¡Œå®Œæ•´zkSNARKæµ‹è¯•</span>
                        <span x-show="isLoading" class="flex items-center gap-2">
                            <div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                            æ­£åœ¨è¿è¡Œå¯†ç å­¦è¯æ˜...
                        </span>
                    </button>
                    
                    <button @click="quickVerify()" 
                            :disabled="isLoading"
                            class="px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg font-semibold transition-colors">
                        âš¡ å¿«é€ŸéªŒè¯çº¦æŸ
                    </button>
                </div>
            </div>
        </div>

        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div x-show="result" class="max-w-4xl mx-auto">
            <div class="bg-white/10 backdrop-blur rounded-xl p-6 border border-white/20">
                <h3 class="text-xl font-semibold mb-4">ğŸ“Š æµ‹è¯•ç»“æœ</h3>
                
                <!-- çº¦æŸéªŒè¯çŠ¶æ€ -->
                <div class="mb-6 p-4 rounded-lg" 
                     :class="result?.jsonResult?.is_constraint_mathematically_correct ? 'bg-green-800/30 border border-green-500/50' : 'bg-red-800/30 border border-red-500/50'">
                    <div class="flex items-center gap-3 mb-2">
                        <span x-text="result?.jsonResult?.is_constraint_mathematically_correct ? 'âœ…' : 'âŒ'" class="text-2xl"></span>
                        <span class="font-semibold text-lg">çº¦æŸéªŒè¯</span>
                    </div>
                    <p x-text="result?.jsonResult?.constraint || 'æœªçŸ¥çº¦æŸ'" class="text-lg font-mono"></p>
                    <p x-text="result?.jsonResult?.explanation || 'æ— è¯´æ˜'" class="text-sm opacity-80"></p>
                </div>

                <!-- zkSNARKè¯æ˜çŠ¶æ€ -->
                <div x-show="result?.jsonResult?.zksnark_proof_valid !== undefined" class="mb-6 p-4 rounded-lg" 
                     :class="result?.jsonResult?.verification_passed ? 'bg-green-800/30 border border-green-500/50' : 'bg-red-800/30 border border-red-500/50'">
                    <div class="flex items-center gap-3 mb-2">
                        <span x-text="result?.jsonResult?.verification_passed ? 'ğŸ”’' : 'ğŸ”“'" class="text-2xl"></span>
                        <span class="font-semibold text-lg">zkSNARKéªŒè¯</span>
                    </div>
                    <p x-text="result?.jsonResult?.verification_passed ? 'zkSNARKè¯æ˜éªŒè¯é€šè¿‡' : 'zkSNARKè¯æ˜éªŒè¯å¤±è´¥'" class="text-lg"></p>
                    <div class="text-sm opacity-80 mt-2">
                        <span>è¯æ˜ç”Ÿæˆ: </span>
                        <span x-text="result?.jsonResult?.zksnark_proof_valid ? 'æˆåŠŸ' : 'å¤±è´¥'" 
                              :class="result?.jsonResult?.zksnark_proof_valid ? 'text-green-300' : 'text-red-300'"></span>
                    </div>
                </div>

                <!-- æ€§èƒ½æ•°æ® -->
                <div x-show="result?.jsonResult?.timing" class="mb-6">
                    <h4 class="font-semibold mb-3">â±ï¸ æ€§èƒ½æ•°æ®</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-white/5 p-3 rounded-lg text-center">
                            <div class="text-2xl font-mono text-blue-400" x-text="result?.jsonResult?.timing?.setup_ms || '0'"></div>
                            <div class="text-xs text-gray-400">é€šç”¨è®¾ç½® (ms)</div>
                        </div>
                        <div class="bg-white/5 p-3 rounded-lg text-center">
                            <div class="text-2xl font-mono text-green-400" x-text="result?.jsonResult?.timing?.index_ms || '0'"></div>
                            <div class="text-xs text-gray-400">ç”µè·¯ç´¢å¼• (ms)</div>
                        </div>
                        <div class="bg-white/5 p-3 rounded-lg text-center">
                            <div class="text-2xl font-mono text-yellow-400" x-text="result?.jsonResult?.timing?.prove_ms || '0'"></div>
                            <div class="text-xs text-gray-400">è¯æ˜ç”Ÿæˆ (ms)</div>
                        </div>
                        <div class="bg-white/5 p-3 rounded-lg text-center">
                            <div class="text-2xl font-mono text-purple-400" x-text="result?.jsonResult?.timing?.verify_ms || '0'"></div>
                            <div class="text-xs text-gray-400">è¯æ˜éªŒè¯ (ms)</div>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <span class="text-sm text-gray-400">æ€»è€—æ—¶: </span>
                        <span class="font-mono text-lg text-orange-400" x-text="result?.jsonResult?.timing?.total_ms || '0'"></span>
                        <span class="text-sm text-gray-400"> ms</span>
                    </div>
                </div>

                <!-- è¯¦ç»†è¾“å‡º -->
                <div class="mb-4">
                    <button @click="showDetails = !showDetails" 
                            class="flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors">
                        <span x-text="showDetails ? 'ğŸ”½' : 'â–¶ï¸'"></span>
                        <span x-text="showDetails ? 'éšè—è¯¦ç»†è¾“å‡º' : 'æ˜¾ç¤ºè¯¦ç»†è¾“å‡º'"></span>
                    </button>
                </div>

                <div x-show="showDetails" class="bg-black/40 p-4 rounded-lg font-mono text-sm overflow-x-auto">
                    <pre x-text="result?.output || 'æ— è¾“å‡º'"></pre>
                </div>

                <!-- RustéªŒè¯æ ‡è®° -->
                <div class="mt-4 flex justify-center">
                    <div class="inline-flex items-center px-4 py-2 bg-orange-800/30 text-orange-300 rounded-full text-sm border border-orange-500/50">
                        <span class="text-lg mr-2">ğŸ¦€</span>
                        <span>æ­¤ç»“æœæ¥è‡ªçœŸå®çš„Rust Marlin zkSNARKå®ç°</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¯´æ˜åŒºåŸŸ -->
        <div class="max-w-4xl mx-auto mt-8">
            <div class="bg-white/5 backdrop-blur rounded-xl p-6 border border-white/10">
                <h3 class="text-xl font-semibold mb-4">ğŸ“ ç³»ç»Ÿè¯´æ˜</h3>
                <div class="grid md:grid-cols-2 gap-6 text-sm text-gray-300">
                    <div>
                        <h4 class="font-semibold text-white mb-2">âœ… æ­£ç¡®çº¦æŸ</h4>
                        <p>å½“è¾“å…¥çš„çº¦æŸæ•°å­¦ä¸Šæ­£ç¡®æ—¶ï¼ˆå¦‚3Ã—5=15ï¼‰ï¼ŒzkSNARKç³»ç»Ÿå°†ï¼š</p>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>æˆåŠŸç”Ÿæˆå¯†ç å­¦è¯æ˜</li>
                            <li>éªŒè¯é€šè¿‡</li>
                            <li>æ˜¾ç¤ºç»¿è‰²æˆåŠŸçŠ¶æ€</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white mb-2">âŒ é”™è¯¯çº¦æŸ</h4>
                        <p>å½“è¾“å…¥çš„çº¦æŸæ•°å­¦ä¸Šé”™è¯¯æ—¶ï¼ˆå¦‚3Ã—5=16ï¼‰ï¼ŒzkSNARKç³»ç»Ÿå°†ï¼š</p>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li>ä»èƒ½ç”Ÿæˆè¯æ˜</li>
                            <li>ä½†éªŒè¯ä¼šå¤±è´¥</li>
                            <li>æ˜¾ç¤ºçº¢è‰²å¤±è´¥çŠ¶æ€</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-6 px-4 py-3 bg-blue-800/20 border border-blue-500/30 rounded-lg">
                    <p class="text-blue-200 text-sm">
                        ğŸ’¡ <strong>é‡è¦:</strong> è¿™æ˜¯ä¸€ä¸ªçœŸå®çš„é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿï¼æ¯æ¬¡æµ‹è¯•éƒ½è¿è¡Œå®Œæ•´çš„Marlinåè®®ï¼ŒåŒ…æ‹¬é€šç”¨ä¿¡ä»»è®¾ç½®ã€ç”µè·¯ç´¢å¼•ã€è¯æ˜ç”Ÿæˆå’ŒéªŒè¯ã€‚è¿™ä¸æ˜¯æ¨¡æ‹Ÿï¼Œè€Œæ˜¯çœŸæ­£çš„å¯†ç å­¦è®¡ç®—ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function constraintTester() {
            return {
                inputs: {
                    a: 3,
                    b: 5,
                    c: 15
                },
                result: null,
                isLoading: false,
                showDetails: false,

                setConstraint(a, b, c) {
                    this.inputs = { a, b, c };
                },

                async runConstraintTest() {
                    this.isLoading = true;
                    this.result = null;
                    this.showDetails = false;

                    try {
                        const response = await fetch('http://localhost:3000/api/full-demo', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.inputs)
                        });

                        const data = await response.json();
                        
                        // å°è¯•è§£æåµŒå¥—çš„JSONç»“æœ
                        if (data.output) {
                            const lines = data.output.split('\n');
                            for (const line of lines) {
                                if (line.trim().startsWith('{')) {
                                    try {
                                        data.jsonResult = JSON.parse(line.trim());
                                        break;
                                    } catch (e) {
                                        // ç»§ç»­æŸ¥æ‰¾
                                    }
                                }
                            }
                        }
                        
                        this.result = data;
                        
                        // è‡ªåŠ¨æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯å¦‚æœæ²¡æœ‰è§£æåˆ°JSON
                        if (!data.jsonResult) {
                            this.showDetails = true;
                        }
                        
                    } catch (error) {
                        console.error('Error:', error);
                        this.result = {
                            success: false,
                            error: error.message
                        };
                    } finally {
                        this.isLoading = false;
                    }
                },

                async quickVerify() {
                    this.isLoading = true;
                    this.result = null;
                    this.showDetails = false;

                    try {
                        const response = await fetch('http://localhost:3000/api/verify-constraint', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.inputs)
                        });

                        const data = await response.json();
                        
                        // å°è¯•è§£æåµŒå¥—çš„JSONç»“æœ
                        if (data.output) {
                            const lines = data.output.split('\n');
                            for (const line of lines) {
                                if (line.trim().startsWith('{')) {
                                    try {
                                        data.jsonResult = JSON.parse(line.trim());
                                        break;
                                    } catch (e) {
                                        // ç»§ç»­æŸ¥æ‰¾
                                    }
                                }
                            }
                        }
                        
                        this.result = data;
                        
                    } catch (error) {
                        console.error('Error:', error);
                        this.result = {
                            success: false,
                            error: error.message
                        };
                    } finally {
                        this.isLoading = false;
                    }
                }
            }
        }
    </script>
</body>
</html>